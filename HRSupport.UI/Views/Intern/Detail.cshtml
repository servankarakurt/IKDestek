@model HRSupport.UI.Models.InternDetailViewModel
@{
    ViewData["Title"] = "Stajyer Detayı";
    var canAddTaskOrNote = ViewData["CanAddTaskOrNote"] as bool? ?? true;
}

<div class="container-fluid py-4">
    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show">@TempData["SuccessMessage"]<button type="button" class="btn-close" data-bs-dismiss="alert"></button></div>
    }
    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show">@TempData["ErrorMessage"]<button type="button" class="btn-close" data-bs-dismiss="alert"></button></div>
    }

    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="mb-0"><i class="bi bi-mortarboard me-2"></i>@Model.FullName</h2>
        <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-warning text-dark"><i class="bi bi-pencil me-1"></i>Düzenle</a>
    </div>

    <div class="row">
        <div class="col-lg-5">
            <div class="card shadow-sm border-0 mb-4">
                <div class="card-header bg-light"><h5 class="mb-0">Temel Bilgiler</h5></div>
                <div class="card-body">
                    <dl class="row mb-0">
                        <dt class="col-sm-4">E-posta</dt><dd class="col-sm-8">@Model.Email</dd>
                        <dt class="col-sm-4">Telefon</dt><dd class="col-sm-8">@Model.Phone</dd>
                        <dt class="col-sm-4">Üniversite</dt><dd class="col-sm-8">@(Model.University ?? "—")</dd>
                        <dt class="col-sm-4">Bölüm</dt><dd class="col-sm-8">@(Model.Major ?? "—")</dd>
                        <dt class="col-sm-4">Sınıf</dt><dd class="col-sm-8">@Model.Grade</dd>
                        <dt class="col-sm-4">Staj Başlangıç</dt><dd class="col-sm-8">@Model.StartDate.ToString("dd.MM.yyyy")</dd>
                        <dt class="col-sm-4">Staj Bitiş</dt><dd class="col-sm-8">@Model.EndDate.ToString("dd.MM.yyyy")</dd>
                        <dt class="col-sm-4">Mentor</dt><dd class="col-sm-8">@(Model.MentorName ?? "Atanmadı")</dd>
                    </dl>
                </div>
            </div>
        </div>
        <div class="col-lg-7">
            <div class="card shadow-sm border-0 mb-4">
                <div class="card-header bg-light"><h5 class="mb-0">Verilen Görevler</h5></div>
                <div class="card-body">
                    @if (canAddTaskOrNote)
                    {
                        <form asp-action="AddTask" method="post" class="mb-3">
                            @Html.AntiForgeryToken()
                            <input type="hidden" name="internId" value="@Model.Id" />
                            <div class="input-group">
                                <input type="text" name="title" class="form-control" placeholder="Görev başlığı..." required maxlength="500" />
                                <input type="text" name="description" class="form-control" placeholder="Açıklama (opsiyonel)" maxlength="1000" />
                                <button type="submit" class="btn btn-success">Ekle</button>
                            </div>
                        </form>
                    }
                    @if (Model.Tasks != null && Model.Tasks.Any())
                    {
                        <ul class="list-group list-group-flush">
                            @foreach (var t in Model.Tasks)
                            {
                                <li class="list-group-item px-0 d-flex justify-content-between align-items-start">
                                    <div>
                                        <strong>@t.Title</strong>
                                        @if (!string.IsNullOrEmpty(t.Description)) { <span class="text-muted"> — @t.Description</span> }
                                        <br /><small class="text-muted">@t.CreatedTime.ToString("dd.MM.yyyy")</small>
                                    </div>
                                    @if (t.IsCompleted) { <span class="badge bg-success">Tamamlandı</span> }
                                </li>
                            }
                        </ul>
                    }
                    else
                    {
                        <p class="text-muted mb-0">Henüz görev eklenmemiş.</p>
                    }
                </div>
            </div>

            <div class="card shadow-sm border-0">
                <div class="card-header bg-light"><h5 class="mb-0">Mentor Notları</h5></div>
                <div class="card-body">
                    @if (canAddTaskOrNote)
                    {
                        <form asp-action="AddMentorNote" method="post" class="mb-3">
                            @Html.AntiForgeryToken()
                            <input type="hidden" name="internId" value="@Model.Id" />
                            <div class="mb-2">
                                <input type="date" name="noteDate" class="form-control form-control-sm d-inline-block w-auto" />
                                <span class="text-muted small"> (opsiyonel: not tarihi)</span>
                            </div>
                            <div class="input-group">
                                <textarea name="noteText" class="form-control" placeholder="Haftalık geri bildirim / mentor notu..." required rows="2"></textarea>
                                <button type="submit" class="btn btn-info text-white">Not Ekle</button>
                            </div>
                        </form>
                    }
                    @if (Model.MentorNotes != null && Model.MentorNotes.Any())
                    {
                        <ul class="list-group list-group-flush">
                            @foreach (var n in Model.MentorNotes)
                            {
                                <li class="list-group-item px-0">
                                    <small class="text-muted">@n.CreatedTime.ToString("dd.MM.yyyy HH:mm") @(n.NoteDate.HasValue ? $" (Dönem: {n.NoteDate.Value:dd.MM.yyyy})" : "") @(string.IsNullOrEmpty(n.MentorName) ? "" : $" — {n.MentorName}")</small>
                                    <p class="mb-0 mt-1">@n.NoteText</p>
                                </li>
                            }
                        </ul>
                    }
                    else
                    {
                        <p class="text-muted mb-0">Henüz mentor notu yok.</p>
                    }
                </div>
            </div>
        </div>
    </div>

    <div class="mt-3">
        <a asp-action="Index" class="btn btn-outline-secondary"><i class="bi bi-arrow-left me-1"></i>Listeye Dön</a>
    </div>
</div>
